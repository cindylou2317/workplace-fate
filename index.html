<script>
  const FATES = [
    // … (insert your full 44-item list here) …
  ];

  // Utility selectors
  const $ = sel => document.querySelector(sel);
  const nameInput = $('#name');
  const btnReveal  = $('#reveal');
  const btnAgain   = $('#again');
  const btnCopy    = $('#copy');
  const btnTweet   = $('#tweet');
  const resultBox  = $('#result');
  const audioToggle= $('#audioToggle');
  const ambience   = document.getElementById('ambience');

  // Full random pick from all fates
  function pickFate() {
    return FATES[Math.floor(Math.random() * FATES.length)];
  }

  // Sanitize user input
  function sanitize(str) {
    return String(str).replace(/[<>]/g, '');
  }

  // Render the selected fate
  function renderFate() {
    const name = sanitize(nameInput.value.trim() || 'Somebody');
    const fate = pickFate();
    const text = fate.text.replace(/{name}/g, name);
    resultBox.innerHTML = `
      <strong>${name}:</strong><br>
      <span class="fate-text">${text}</span>
    `;
    btnReveal.style.display = 'none';
    btnAgain.style.display  = 'inline-block';
  }

  // Event Listeners
  btnReveal.addEventListener('click', renderFate);
  btnAgain.addEventListener('click', () => {
    renderFate();
    nameInput.focus();
  });

  btnCopy.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(resultBox.innerText.trim());
      btnCopy.textContent = 'Copied!';
      setTimeout(() => btnCopy.textContent = 'Copy', 1200);
    } catch {
      btnCopy.textContent = 'Error';
      setTimeout(() => btnCopy.textContent = 'Copy', 1200);
    }
  });

  btnTweet.addEventListener('click', () => {
    const txt = encodeURIComponent(resultBox.innerText.trim() || 'My spooky compliance fate!');
    const url = `https://twitter.com/intent/tweet?text=${txt}`;
    window.open(url, '_blank', 'noopener');
  });

  // Audio toggle logic
  let audioLoaded = false;
  const audioSrc = 'ambience.mp3';

  fetch(audioSrc, { method: 'HEAD' })
    .then(r => { if (r.ok) { ambience.src = audioSrc; audioLoaded = true; } })
    .catch(() => {/* no audio found */});

  audioToggle.addEventListener('click', async () => {
    if (!audioLoaded) {
      audioToggle.textContent = 'No Audio Found';
      setTimeout(() => audioToggle.textContent = 'Play Ambience', 1400);
      return;
    }
    if (ambience.paused) {
      try {
        await ambience.play();
        audioToggle.textContent = 'Pause Ambience';
        audioToggle.setAttribute('aria-pressed', 'true');
      } catch {
        audioToggle.textContent = 'Enable Audio';
        setTimeout(() => audioToggle.textContent = 'Play Ambience', 1400);
      }
    } else {
      ambience.pause();
      audioToggle.textContent = 'Play Ambience';
      audioToggle.setAttribute('aria-pressed', 'false');
    }
  });

  // Pressing Enter in the name field triggers the reveal
  nameInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      renderFate();
    }
  });

  // Optionally render one immediately
  // setTimeout(() => { if (!resultBox.innerText.trim()) renderFate(); }, 400);
</script>
